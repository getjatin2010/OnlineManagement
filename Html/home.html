<!DOCTYPE html>
<html>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-animate.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-aria.min.js"></script>
  <script src="http://momentjs.com/downloads/moment.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-messages.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angular_material/1.1.0-rc2/angular-material.min.js"></script>
  <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/angular_material/1.1.0-rc2/angular-material.min.css">
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-route.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <head>
    <style>
      .md-3-line
      {
      border-bottom: 6pt double white;
      }
       .md-4-line-contact
      {
      border-bottom: 3pt  white;
      }
      .md-list-item-text
      {
      width : 100%;
      padding-left : 10px;
      padding-bottom : 20px;
      }
      .datepickerdemoBasicUsage {
      /** Demo styles for mdCalendar. */ }
      .datepickerdemoBasicUsage md-content {
      padding-bottom: 200px; }
      .datepickerdemoBasicUsage .validation-messages {
      font-size: 12px;
      color: #dd2c00;
      margin: 10px 0 0 25px; }
      ul {
      list-style-type: none;
      margin: 0;
      padding: 0;
      overflow: hidden;
      color:#000000;
      background-color: #FFFFFF;
      }
      li {
      float: left;
      }
      li a {
      display: block;
      text-align: center;
      padding: 14px 16px;
      text-decoration: none;
      font-weight: bold;
      }
      li a:hover {
      color: #9076F6;
      }
      input[type=date],input[type='text']
      {
      padding: 12px 20px;
      margin: 8px 0;
      border: none;
      border-bottom: 2px solid red;
      }
      #recordForm {
      margin-top: 100px;
      }
      .md-raised
      {
      width : 25%;
      height : 10%;
      }
      .button
      {
      background-color: #4CAF50; /* Green */
      border: none;
      color: white;
      padding: 15px 32px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      border-radius: 8px;
      box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
      }
      .button:hover {
      background-color: #4AAFFF; /* Green */
      color: white;
      }
      form.recordForm {
      margin:auto;
      width: 40%;
      padding: 10px;
      background-color: lightyellow;
      border-style: solid;
      border-width: 5px;
      border-color: #9076F6;
      border-radius: 25px;
      box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
      }
      div.heading
      {
      text-align: center;	
      background-color: #FFFFFF;
      background-image:url(../img/symphony.png);
      background-size:15%;
      background-attachment:scroll;
      background-repeat:none;
      background-position:right;
      padding: 1px;
      border-style: solid;
      border-width: 5px 0px 5px 0px;
      border-color: #424242;
      color: #424242;
      font-family: 'Open Sans', Arial, sans-serif;;
      font-style:bold;
      }
      body
      {
      background-color:#FFFFFF;
      font-family: Verdana;
      }
      div.holdingForm
      {
      margin-top: -2cm;	
      margin-bottom:30px;
      }
      div.dateHolder
      {
      text-align: left;	
      }
      .responseButton
      {
      width : 30%;
      }
      @media only screen and (max-width:556px){
      form.recordForm {
      width:80%;
      }
      ul{
      width:100%
      }
      li
      {
      width:100%
      }
      md-dialog {
      position:absolute;
      top:10%;
      left:10%;
      }
      .responseButton
      {
      width : 100%;
      margin-right : 3px;
      }
      }
      div.confirmButton
      {
      text-align: center;	
      }
      div.data
      {
      color: #FFFFFF;	
      }
      .underCons
      {
      margin-top: 10%;
      margin-left: 40%;
      }
      .class_li
      {
      color:black;
      }
      .responseClass{
      color: #0000ff;
      }
    </style>
  </head>
  <body ng-app = "homeMainApp">
    <div class="heading" layout = "row">
      <img src = "../img/logo.png" style = "width:20%;"/>
      <h1>
        EPIC Delivery Tracking System
      </h1>
    </div>
    <ul>
      <li><a href="#createNewRecord">New Transaction</a></li>
      <li><a href="#pending">Pending Transactions</a></li>
      <li><a href="#CompletedTransactions">Completed Transactions</a></li>
      <li><a href="#Contacts">Contact List</a></li>
      <li><a href="#trash">Trash</a></li>
      <li><a href="#reports">Reports</a></li>
      <li style="float:right"><a href="../UtilityFiles/logout.php">Logout</a></li>
    </ul>
    <div ng-view class="data" ></div>
    <script>
      var app = angular.module("homeMainApp",["ngRoute","ngMaterial","ngMessages"]);
      app.config(
      function($routeProvider,$mdDateLocaleProvider)
      {
      
      
      $mdDateLocaleProvider.formatDate = 
      function(date) {
              return date ? moment(date).format('DD-MM-YYYY') : '';
          	       };
      
      
       $routeProvider
          .when("/createNewRecord", {
              templateUrl : "../Html/createNewRecord.html", controller: "recordController"
          })
          .when("/CompletedTransactions", {
              templateUrl : "../Html/history.html", controller: "historyControl"
          })
          .when("/about", {
              templateUrl : "../Html/about.html"
          })
          .when("/pending", {
              templateUrl : "../Html/pending.html", controller: "pendingControl"
          })
          .when("/trash", {
              templateUrl : "../Html/trash.html", controller: "trashControl"
          })
          .when("/Contacts", {
              templateUrl : "../Html/contacts.html", controller: "contactsControl"
          })
          .when("/reports", {
              templateUrl : "../Html/reports.html"
          });
      });
      
      
      app.controller('recordController',function($scope,$http,$mdDialog,$window)
      {
      $scope.max_date = new Date();
      
      
      $http.post('../UtilityFiles/GetDistrict.php',$scope.data).then
      (
      function(response)
      {
      if(response.data.login==0)
        {
        $window.alert("Please Login");
        $window.location.href = '../Face/login.php';
        }
      else
        {
              $scope.districts = response.data;
        }  
      }
      
      );
      
      $scope.emptyAssemblies =function()
      {
      $scope.assemblies = "";
      }
      
      $scope.loadAssemblies = function()
      {
      if($scope.data.districtSelected!=null)
      {
      	$http.post('../UtilityFiles/GetAssembly.php',$scope.data.districtSelected).then(
      		function(response) {
      			$scope.assemblies = response.data;
      		}
      	);
      }
      
      }
      
      
      $scope.loadSendingOptions = function()
      {
      $http.post('../UtilityFiles/GetSendingOptions.php',$scope.data).then
      (
      function(response)
      {
      $scope.mediums = response.data;
      }
      
      );
      
      }
      
      $scope.myDate = new Date();
      
      $scope.minDate = new Date(
            $scope.myDate.getFullYear(),
            $scope.myDate.getMonth() - 2,
            $scope.myDate.getDate());
      
      $scope.maxDate = new Date(
            $scope.myDate.getFullYear(),
            $scope.myDate.getMonth() + 2,
            $scope.myDate.getDate());
      
      $scope.data = {};
      $scope.error = "";
      
      
      
      $scope.dataRecordSend = function()
      {
      $scope.districtObject = angular.fromJson($scope.data.districtSelected);
      $scope.assemblyObject = angular.fromJson($scope.data.assemblySelected);
      $scope.mediumObject = angular.fromJson($scope.data.mediumSelected);
      
      
      $scope.error = "";
      if($scope.data.sendDate == "" || $scope.data.sendDate == null)
      {
      $scope.error = "Please select Date of sending";
      }
      else if($scope.data.districtSelected == "" || $scope.data.districtSelected == null)
      {
      $scope.error = "Please select district";
      }
      else if($scope.data.assemblySelected == "" || $scope.data.assemblySelected == null)
      {
      $scope.error = "Please select Assembly";
      }
      
      else if($scope.data.quantity == "" || $scope.data.quantity == null || $scope.data.quantity<=0)
      {
      $scope.error = "Please select Quantity";
      }
      else if($scope.data.mediumSelected == "" || $scope.data.mediumSelected == null)
      {
      $scope.error = "Please select medium of sending";
      }
      else
      {
      
      
      $scope.value = $scope.data.sendDate.toString();
      $scope.data.sendDateString = $scope.value.slice(0,16);
      
      //to cover the indian time zone
      $scope.data.sendDate.setHours(12);
      
      	$mdDialog.show({
      	clickOutsideToClose: true,
      	scope: $scope,        // use parent scope in template
      	preserveScope: true,  // do not forget this if use parent scope
      	// Since GreetingController is instantiated with ControllerAs syntax
      	// AND we are passing the parent '$scope' to the dialog, we MUST
      	// use 'vm.<xxx>' in the template markup
      	template: '<md-dialog layout-padding>' +
      		    '  <md-dialog-content>' +
      		    '<h3>New Transaction Details</h3>' + 
      		    ' <br>Date of Sending : {{data.sendDateString}} <br>  ' +
      		    ' District : {{districtObject.district}}<br>  ' +
      		    ' Assembly : {{assemblyObject.ac}}<br> ' +
      		    ' Medium : {{mediumObject.medium_name}}<br> ' +
      		    ' Quantity : {{data.quantity}} <br>  ' +
      		    ' Comments : {{data.comment}}<br>'+
      		    ' </md-dialog-content>' +
      	            ' <md-dialog-actions>' +
      		    ' <md-button ng-click="closeDialog()" class="md-primary">' +
      		    '      Cancel' +
      		    '    </md-button>' +
      		    '    <md-button ng-click="sendData()" class="md-primary">' +
      		    '      Save Transaction' +
      		    '    </md-button>' +				   
      		    '  </md-dialog-actions>' +
      	 	    '	</md-dialog>',
      	controller: function DialogController($scope, $mdDialog,$http) 
      	{
      		$scope.closeDialog = function() 
      		{
      		$mdDialog.hide();
      		}
      	
      		$scope.sendData = function()
      		{
      			$http.post('../UtilityFiles/CreateNewRecord.php',$scope.data).then
      			(
      				function(response) 
      				{
      				$mdDialog.hide();
      				$scope.data = "";
      				}
      
      			);
      
      		}
      
      	}       			
      
      	});
      
      }
      
      
      
      }
      
      });
      
      
      
      
      
      window.mobilecheck = function() {
        var check = false;
        (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
        return check;
      };
      
      app.controller('historyControl', function($scope,$http,$mdDialog,$window) {
      
      
      
      $scope.buttonValue = ""; 
      $scope.received = "";
      $http.post('../UtilityFiles/history.php').then
      (
      function(response) 
      {
        if(response.data.login==0)
      {
        $window.alert("Please Login");
        $window.location.href = '../Face/login.php';
      }
      else
      {
         $scope.history = (response.data);
         $scope.historyBackup = (response.data);
         $scope.historySumQuantity = 0;
         $scope.historySumCorrect = 0;
	    angular.forEach($scope.historyBackup, function(value, key){


	  		$scope.historySumQuantity =   parseInt($scope.historyBackup[key].quantity, 10) +  $scope.historySumQuantity  ;
            $scope.correctEpic =  parseInt($scope.historyBackup[key].received,10) - parseInt($scope.historyBackup[key].defective,10);
            $scope.historySumCorrect =  $scope.correctEpic +  $scope.historySumCorrect  ;
        	
            
        });

	  	//console.log();

      }
      }
      
      );
      
      
      
      $http.post('../UtilityFiles/GetOptions.php',$scope.data).then
      (
      function(response)
      {
      $scope.districtsForDisplay = response.data;
      $scope.districtsForDisplay.districtsForDisplaySelected = $scope.districtsForDisplay[0];
      }
      );
      
      $scope.getNewValuesForHistory =function()
      {
      $scope.found=false;
      $scope.history = [];
      //$scope.history.push($scope.historyBackup[0]);
      if($scope.districtsForDisplay.districtsForDisplaySelected.districtId<=22 && $scope.districtsForDisplay.districtsForDisplaySelected.districtId>=1 )
      	{
      		$scope.historySumQuantity = 0;
      		$scope.historySumCorrect =0 ;
      		angular.forEach($scope.historyBackup, function(value, key){
      		
      	
      		if($scope.historyBackup[key].districtId==$scope.districtsForDisplay.districtsForDisplaySelected.districtId)
      		{		
      			$scope.found=true;

      		$scope.historySumQuantity =   parseInt($scope.historyBackup[key].quantity, 10) +  $scope.historySumQuantity  ;
            $scope.correctEpic =  parseInt($scope.historyBackup[key].received,10) - parseInt($scope.historyBackup[key].defective,10);
            $scope.historySumCorrect =  $scope.correctEpic +  $scope.historySumCorrect  ;
        	


      			$scope.history.push($scope.historyBackup[key]);
      		}		
      	});
      	}
      	else
      	{
      		$scope.found=true;
      		$scope.history = $scope.historyBackup;

      		$scope.historySumQuantity = 0;
         $scope.historySumCorrect = 0;
	    angular.forEach($scope.historyBackup, function(value, key){


	  		$scope.historySumQuantity =   parseInt($scope.historyBackup[key].quantity, 10) +  $scope.historySumQuantity  ;
            $scope.correctEpic =  parseInt($scope.historyBackup[key].received,10) - parseInt($scope.historyBackup[key].defective,10);
            $scope.historySumCorrect =  $scope.correctEpic +  $scope.historySumCorrect  ;
        	
            
        });

      	}
      	
      
      
      if($scope.found==false)
      	{
      	 $mdDialog.show(
            $mdDialog.alert()
              .parent(angular.element(document.querySelector('#popupContainer')))
              .clickOutsideToClose(true)
              .title('No Completed Transactions for this district')
              .textContent('')
              .ariaLabel('Alert')
              .ok('Got it!')
          );
      	}
      // $http.post('../UtilityFiles/history.php',$scope.districtsForDisplay.districtsForDisplaySelected).then
      // (
      // function(response) 
      // {
      // console.log(response.data);
      // $scope.history = (response.data);
      // }
      // );
      }
      
      
      $scope.showResponse = function(ev) {
      $http.post('../UtilityFiles/getResponse.php',ev).then(
      		function(response) {
      			$scope.received = response.data;
           			$scope.text = "Response ID : "+$scope.received.responseId+"<br> Received Pieces : "+$scope.received.received+"<br> Defective Pieces : "+$scope.received.defective+"<br>Comments : "+$scope.received.comments+"<br>Date of entry : "+$scope.received.responseId+"\n" ;
          			
      			$mdDialog.show({
      				  clickOutsideToClose: true,
      				  scope: $scope,        // use parent scope in template
      				  preserveScope: true,  // do not forget this if use parent scope
      				  // Since GreetingController is instantiated with ControllerAs syntax
      				  // AND we are passing the parent '$scope' to the dialog, we MUST
      				  // use 'vm.<xxx>' in the template markup
      				  template: '<md-dialog layout-padding>' +
      					    '  <md-dialog-content>' +
      					    '<h3>Response Received</h3>' + 
      					    ' <br>ResponseID : {{received.responseId}} <br>  ' +
      						'Received Pieces : {{received.received}} <br> '+
      					    ' Defective pieces : {{received.defective}}<br>  ' +
      					    ' Comments : {{received.comments}}<br> ' +
      					    ' Entry Date : {{received.time}}<br>'+
      						'<br><h4>Response By: {{received.response_by}}</h4>'+
      					    ' </md-dialog-content>' +
      					   '  <md-dialog-actions>' +
      					   '    <md-button ng-click="closeDialog()" class="md-primary">' +
      					   '      Ok' +
      					   '    </md-button>' +
      					   '  </md-dialog-actions>' +
      		   			   '	</md-dialog>',
      				  controller: function DialogController($scope, $mdDialog) {
      				    $scope.closeDialog = function() {
      				      $mdDialog.hide();
      				    }
      				  }
             			});
      		}
      	);
        };
      
      
      });
      
      
      app.controller('pendingControl', function($scope,$http,$mdDialog,$route,$window) {
       
      $http.post('../UtilityFiles/pending.php').then
      (
      function(response) 
      {
      if(response.data.login==0)
        {
        $window.alert("Please Login");
        $window.location.href = '../Face/login.php';
        }
      else
      {
        $scope.pending = (response.data);
        $scope.pendingBackup = (response.data);
        $scope.pendingSum = 0;
        angular.forEach($scope.pendingBackup, function(value, key){
        
            $scope.pendingSum =   parseInt($scope.pendingBackup[key].quantity, 10) +  $scope.pendingSum ;
        });

      }
      }
      
      );
      
      
      $http.post('../UtilityFiles/GetOptions.php',$scope.data).then
      (
      function(response)
      {
      $scope.districtsForDisplay = response.data;
      $scope.districtsForDisplay.districtsForDisplaySelected = $scope.districtsForDisplay[0];
      }
      );
      
       function DialogController($scope, $mdDialog,$route) {
          $scope.hide = function() {
            $mdDialog.hide();
          };
          $scope.cancel = function() {
            $mdDialog.cancel();
          };
          $scope.answer = function(answer) {
            $mdDialog.hide(answer);
          };
        }
      
      
      
      $scope.disableTransaction = function(ev) {
          // Appending dialog to document.body to cover sidenav in docs app
          var confirm = $mdDialog.confirm()
                .title('Are you sure, you want to disable the transaction?')
                .ariaLabel('DISABLE TRANSACTION')
                .ok('YES')
                .cancel('NO');
      
          $mdDialog.show(confirm).then(function() {
            $scope.status = 'You have disabled.';
             $http.post('../UtilityFiles/MakeTrash.php',ev).then
      		(
      		function(response) 
      		{
      			if(response.data.trashed==1)
      			{
      				$route.reload();
      			}
      			else
      			{
      				 $mdDialog.show(
            $mdDialog.alert()
              .parent(angular.element(document.querySelector('#popupContainer')))
              .clickOutsideToClose(true)
              .title('Some error Occured')
              .textContent('')
              .ariaLabel('Alert')
              .ok('Got it!')
          );
      			}
      			
      		}
      		);	
          }, function() {
            $scope.status = 'You have not disabled';
          });
        };
      
      
      
      $scope.getNewValuesForPending =function()
      {
      $scope.found = false;
      $scope.pending = [];
      //$scope.pending.push($scope.pendingBackup[0]);
      if($scope.districtsForDisplay.districtsForDisplaySelected.districtId<=22 && $scope.districtsForDisplay.districtsForDisplaySelected.districtId>=1 )
      	{


          $scope.pendingSum = 0;

      		angular.forEach($scope.pendingBackup, function(value, key){
      		if($scope.pendingBackup[key].districtId==$scope.districtsForDisplay.districtsForDisplaySelected.districtId)
      		{
      			$scope.found = true;		
      			$scope.pending.push($scope.pendingBackup[key]);
            $scope.pendingSum =   parseInt($scope.pendingBackup[key].quantity, 10) +  $scope.pendingSum ;
      		}

      	});
      	}
      	else
      	{
      
      		$scope.found = true;
      		$scope.pending = $scope.pendingBackup;
      		   $scope.pendingSum = 0;
        angular.forEach($scope.pendingBackup, function(value, key){
        
            $scope.pendingSum =   parseInt($scope.pendingBackup[key].quantity, 10) +  $scope.pendingSum ;
        });
      	}
      
      	if($scope.found==false)
      	{
      	 $mdDialog.show(
            $mdDialog.alert()
              .parent(angular.element(document.querySelector('#popupContainer')))
              .clickOutsideToClose(true)
              .title('No Pending Transactions for this district')
              .textContent('')
              .ariaLabel('Alert')
              .ok('Got it!')
          );
      	}
      	
      
      
      
      // $http.post('../UtilityFiles/pending.php',$scope.districtsForDisplay.districtsForDisplaySelected).then
      // (
      // function(response) 
      // {
      // $scope.pending = (response.data);
      // }
      // );
      }
      
      
      });
      
      
      app.controller('contactsControl', function($scope,$http,$mdDialog,$route,$window) {
       
      $http.post('../UtilityFiles/contacts.php').then
      (
      function(response) 
      {
         if(response.data.login==0)
        {
        $window.alert("Please Login");
        $window.location.href = '../Face/login.php';
        }
        else
        {
        $scope.contacts = (response.data);
        $scope.contactsBackup = (response.data);    
        }
      }
      
      );
      
      
      $http.post('../UtilityFiles/GetOptionContacts.php',$scope.data).then
      (
      function(response)
      {
      $scope.districtsForDisplay = response.data;
      $scope.districtsForDisplay.districtsForDisplaySelected = $scope.districtsForDisplay[0];
      }
      );
      
       function DialogController($scope, $mdDialog,$route) {
          $scope.hide = function() {
            $mdDialog.hide();
          };
          $scope.cancel = function() {
            $mdDialog.cancel();
          };
          $scope.answer = function(answer) {
            $mdDialog.hide(answer);
          };
        }
      
      
      
      
   
      
      $scope.getNewValuesForContacts =function()
      {
      $scope.found = false;
      $scope.contacts = [];
      //$scope.contacts.push($scope.contactsBackup[0]);
        if($scope.districtsForDisplay.districtsForDisplaySelected.districtId == 99)
        {
          $scope.found = true;
          $scope.contacts = $scope.contactsBackup;
        }
        else
        {
           angular.forEach($scope.contactsBackup, function(value, key)
          {
          if($scope.contactsBackup[key].districtName == $scope.districtsForDisplay.districtsForDisplaySelected.district)
          {
            $scope.found = true;    
            $scope.contacts.push($scope.contactsBackup[key]);
          }   
        }
        );
        }
      
        if($scope.found==false)
        {
         $mdDialog.show(
            $mdDialog.alert()
              .parent(angular.element(document.querySelector('#popupContainer')))
              .clickOutsideToClose(true)
              .title('No Transactions in contacts for this district')
              .textContent('')
              .ariaLabel('Alert')
              .ok('Got it!')
          );
        }
        
      }
      
      
      });



      app.controller('trashControl', function($scope,$http,$mdDialog,$route,$window) {
       
      $http.post('../UtilityFiles/trash.php').then
      (
      function(response) 
      {
         if(response.data.login==0)
        {
        $window.alert("Please Login");
        $window.location.href = '../Face/login.php';
        }
        else
        {
        $scope.trash = (response.data);
        $scope.trashBackup = (response.data);    
        }
      }
      
      );
      
      
      $http.post('../UtilityFiles/GetOptions.php',$scope.data).then
      (
      function(response)
      {
      $scope.districtsForDisplay = response.data;
      $scope.districtsForDisplay.districtsForDisplaySelected = $scope.districtsForDisplay[0];
      }
      );
      
       function DialogController($scope, $mdDialog,$route) {
          $scope.hide = function() {
            $mdDialog.hide();
          };
          $scope.cancel = function() {
            $mdDialog.cancel();
          };
          $scope.answer = function(answer) {
            $mdDialog.hide(answer);
          };
        }
      
      
      
      
      $scope.enableTransaction = function(ev) {
          // Appending dialog to document.body to cover sidenav in docs app
          var confirm = $mdDialog.confirm()
                .title('Are you sure, you want to enable the transaction?')
                .ariaLabel('ENABLE TRANSACTION')
                .ok('YES')
                .cancel('NO');
      
          $mdDialog.show(confirm).then(function() {
            $scope.status = 'You have disabled.';
             $http.post('../UtilityFiles/EnableTrash.php',ev).then
          (
          function(response) 
          {
            if(response.data.trashed==1)
            {
              $route.reload();
            }
            else
            {
               $mdDialog.show(
            $mdDialog.alert()
              .parent(angular.element(document.querySelector('#popupContainer')))
              .clickOutsideToClose(true)
              .title('Some error Occured')
              .textContent('')
              .ariaLabel('Alert')
              .ok('Got it!')
          );
            }
            
          }
          );  
          }, function() {
            $scope.status = 'You have not disabled';
          });
        };
      
      
      $scope.getNewValuesForTrash =function()
      {
      $scope.found = false;
      $scope.trash = [];
      //$scope.trash.push($scope.trashBackup[0]);
      if($scope.districtsForDisplay.districtsForDisplaySelected.districtId<=22 && $scope.districtsForDisplay.districtsForDisplaySelected.districtId>=1 )
      	{
      		angular.forEach($scope.trashBackup, function(value, key){
      	
      		if($scope.trashBackup[key].districtId==$scope.districtsForDisplay.districtsForDisplaySelected.districtId)
      		{
      			$scope.found = true;		
      			$scope.trash.push($scope.trashBackup[key]);
      		}		
      	});
      	}
      	else
      	{
      
      		$scope.found = true;
      		$scope.trash = $scope.trashBackup;
      	}
      
      	if($scope.found==false)
      	{
      	 $mdDialog.show(
            $mdDialog.alert()
              .parent(angular.element(document.querySelector('#popupContainer')))
              .clickOutsideToClose(true)
              .title('No Transactions in Trash for this district')
              .textContent('')
              .ariaLabel('Alert')
              .ok('Got it!')
          );
      	}
      	
      
      
      
      // $http.post('../UtilityFiles/trash.php',$scope.districtsForDisplay.districtsForDisplaySelected).then
      // (
      // function(response) 
      // {
      // $scope.trash = (response.data);
      // }
      // );
      }
      
      
      });
      
      
      
      app.controller('reportGenControl', function($scope,$http,$mdDialog,$route,$window) {
       $scope.status = '  ';
         $scope.customFullscreen = false;
         $scope.reportAction = function($reportNumber) {
      	 $scope.reportNumber = $reportNumber;
      		if($reportNumber==2)
      		{
      			$window.open("../reports/EpicsUnderTransition.php",'_blank');
      			return;
      		}
      	
      	
      		$mdDialog.show({
            controller: DialogController,
      	  scope: $scope,
      	  preserveScope: true,
            templateUrl: '../Html/ReportForm.html',
            parent: angular.element(document.body),
            clickOutsideToClose:true,
            fullscreen: $scope.customFullscreen // Only for -xs, -sm breakpoints.
      		})
      	};
        
      $scope.showAlert = function(ev) {
      			    $mdDialog.show(
      			      $mdDialog.alert()
      				.parent(angular.element(document.querySelector('#popupContainer')))
      				.clickOutsideToClose(true)
      				.title('FEATURE NOT SUPPORTED')
      				.textContent('The reports can be generated only on desktop')
      				.ariaLabel('FEATURE NOT SUPPORTED')
      				.ok('ok!')
      				.targetEvent(ev)
      			    );
      			  };
      
      
       function DialogController($scope, $mdDialog,$route,$http) {
      	$scope.max_date = new Date();
          $scope.hide = function() {
            $mdDialog.hide();
          };
          $scope.cancel = function() {
            $mdDialog.cancel();
          };
          $scope.answer = function(answer) {
            $mdDialog.hide(answer);
          };
      }
      $scope.data = {};
      $scope.dataReportSend = function()
      		{
      			
      			  if ($scope.data.fromDate > $scope.data.toDate) {
      						$scope.data.error = "Please select select a valid dates";
      				}
      
      			else if($scope.data.fromDate == "" || $scope.data.fromDate == null || $scope.data.toDate == "" || $scope.data.toDate == null)
      			{
      				$scope.data.error = "Please select select a valid date";
      			}
      			else
      			{
      			$scope.value = $scope.data.fromDate.toString();
      			$scope.data.fromDateString = $scope.value.slice(0,16);
      
      			//to cover the indian time zone
      			$scope.data.fromDate.setHours(12);
      			
      			$scope.value = $scope.data.toDate.toString();
      			$scope.data.toDateString = $scope.value.slice(0,16);
      
      			//to cover the indian time zone
      			$scope.data.toDate.setHours(12);
      			$http.post('../reports/createReport.php',$scope.data).then
      			(
      				function(response) 
      				{
      				$mdDialog.hide();
      				if($scope.reportNumber == 1)
      				$window.open("../reports/AcceptedEpicSummary.php",'_blank');
      				if($scope.reportNumber == 2)
      				$window.open("../reports/EpicsUnderTransition.php",'_blank');
      				}
      			);
      			}
      		}
      		
      
      
      
      $scope.close_dialog = function()
      {
      	$mdDialog.hide();
      }
      });
      
      
      
      
      
      
    </script>
  </body>
</html>
